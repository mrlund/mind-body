/*! Built with http://stenciljs.com */
const{h:t}=window.App;class e{constructor(){this.isClassroomModeOn=!1,this.paused=!0,this.dataLoaded=!1,this.firstFramePath="",this.basePath="../../assets/project",this.isBusy=!1,this.formattedProgress="0"}componentWillLoad(){const t=document.createElement("script");this.firstFramePath=this.basePath+this.project+"/session"+this.session+"/"+this.chapter+"/"+this.animation+"."+this.imgext,t.src=this.basePath+this.project+"/session"+this.session+"/"+this.chapter+"/"+this.animation+".js",document.body.appendChild(t);let e=this;window.playSound=function(t,s){return e.sound&&e.sound.stop(),e.sound=createjs.Sound.play(t,createjs.Sound.INTERRUPT_EARLY,0,0,s),e.sound}}loadAnimation(){if(createjs.Sound.initializeDefaultPlugins()){this.canvas=document.getElementById("canvas1"),this.anim_container=document.getElementById("canvas-container"),this.dom_overlay_container=document.getElementById("dom_overlay_container"),this.comp=AdobeAn.getComposition("44F55725416534409D0912E1F9993575");var t=new createjs.LoadQueue(!1);t.installPlugin(createjs.Sound),t.addEventListener("complete",t=>{this.handleComplete(t)}),t.addEventListener("fileload",t=>{this.handleFileLoad(t)}),t.addEventListener("progress",this.handleQueueProgress(this)),t.loadManifest(lib.properties.manifest,!0,this.basePath+this.project+"/session"+this.session+"/"+this.chapter+"/")}}doneLoading(){this.isBusy=!1,this.dataLoaded=!0}handleFileLoad(t){var e=this.comp.getImages();t&&"image"==t.item.type&&(e[t.item.id]=t.result)}handleQueueProgress(t){return this.isBusy=!0,function(e){t.formattedProgress=e.loaded?(100*e.loaded).toFixed(0):"0",1==e.loaded&&t.doneLoading()}}handleComplete(t){for(var e=this.comp.getSpriteSheet(),s=t.target,i=this.comp.getLibrary(),a=i.ssMetadata,n=0;n<a.length;n++)e[a[n].name]=new createjs.SpriteSheet({images:[s.getResult(a[n].name)],frames:a[n].frames});this.exportRoot=new i.lesson1,this.stage=new i.Stage(this.canvas),this.makeResponsive(!0,"both",!1,1),AdobeAn.compositionLoaded(i.properties.id),this.fnStartAnimation()}fnStartAnimation(){console.log("start animation"),this.stage.addChild(this.exportRoot),createjs.Ticker.setFPS(lib.properties.fps),createjs.Ticker.addEventListener("tick",this.tickHandler(this)),this.paused=!1}makeResponsive(t,e,s,i){console.log("make responsive"),window.addEventListener("resize",()=>this.resizeCanvas(t,e,s,i)),this.resizeCanvas(t,e,s,i)}resizeCanvas(t,e,s,i){console.log("resize canvas");var a,n,o=1,r=lib.properties.width,d=lib.properties.height,l=window.innerWidth,h=window.innerHeight,c=window.devicePixelRatio||1,m=l/r,p=h/d,u=1;t&&("width"==e&&a==l||"height"==e&&n==h?u=o:s?1==i?u=Math.min(m,p):2==i&&(u=Math.max(m,p)):(l<r||h<d)&&(u=Math.min(m,p)));var g=document.getElementById("canvas-container");this.canvas.width=r*c*u,this.canvas.height=d*c*u,this.canvas.style.width=this.dom_overlay_container.style.width=g.style.width=r*u+"px",this.canvas.style.height=g.style.height=this.dom_overlay_container.style.height=d*u+"px",this.stage.scaleX=c*u,this.stage.scaleY=c*u,a=l,n=h,o=u;var v=document.getElementById("canvas1").offsetWidth;this.sizeOfCanvas=v,this.stage.tickOnUpdate=!1,this.stage.update(),this.stage.tickOnUpdate=!0}resizeAnimation(t){if(this.dataLoaded){console.log(document.getElementById("canvas1")),console.log(this.dataLoaded);var e=document.getElementById("canvas1").offsetWidth;document.getElementById("canvas1").style.height=e+"px",document.getElementById("canvas1").style.width=e+"px",t.sizeOfCanvas=e,t.stage&&(t.stage.width=e,t.stage.height=e)}}tickHandler(t){var e=!1;return function(s){t.paused||s.paused||t.stage.update();let i=t.stage.children[0];if(t.timeline=i.timeline,t.timeline.position%10==0&&(t.currentProgressWidth=parseFloat((t.timeline.position/t.timeline.duration*t.sizeOfCanvas).toFixed(0))),0==t.timeline.position&&(e=!1),t.timeline.duration-t.timeline.position==1&&!e){e=!0,createjs.Ticker.setPaused(!0);let s=t.sound;s&&s.setPaused(!0)}}}playPauseAnimation(){if(createjs&&createjs.Ticker){let t=!createjs.Ticker.getPaused(),e=this.sound;e&&e.setPaused(t),createjs.Ticker.setPaused(t),this.paused=t}}rewindAnimationTo(t,e){let s=this.stage.children[0],i=s.timeline;t<0&&(t=0),t>i.duration&&(t=i.duration-10);let a=this.sound;a&&a.setPaused(!0),this.sound.setPosition(e),this.paused?(s.gotoAndStop(t),this.stage.update(),a&&!a.getPaused()&&a.setPaused(!0)):(s.gotoAndPlay(t),a.setPaused(!1))}rewindAnimation(t){t.stopPropagation();let e=this.stage.children[0].timeline,s=Math.round(t.offsetX/this.sizeOfCanvas*e.duration);var i=this.sound.position+5e3;this.rewindAnimationTo(s,i)}rewind5Sec(){let t=lib.properties.fps,e=this.stage.children[0].timeline.position-5*t;var s=this.sound.position-5e3;this.rewindAnimationTo(e,s)}fastForward5Sec(){let t=lib.properties.fps,e=this.stage.children[0].timeline.position+5*t;var s=this.sound.position+5e3;this.rewindAnimationTo(e,s)}playButtonAction(){this.dataLoaded?this.playPauseAnimation():this.loadAnimation()}canvasPlayAnimation(){if(this.dataLoaded){if(createjs&&createjs.Ticker){let t=!1,e=this.sound;e&&e.setPaused(t),createjs.Ticker.setPaused(t),this.paused=t}}else this.loadAnimation()}canvasPauseAnimation(){if(createjs&&createjs.Ticker){let t=!0,e=this.sound;e&&e.setPaused(t),createjs.Ticker.setPaused(t),this.paused=t}}muteVolume(){let t=this.sound;t&&(t.volume=0)}downVolume(){let t=this.sound;t&&t._getVolume()>.9&&(t.volume=t._getVolume()-.1)}upVolume(){let t=this.sound;t&&t._getVolume()<1&&(t.volume=t._getVolume()+.1)}render(){return t("div",null,t("div",{class:"canvas-container",id:"canvas-container"},this.isClassroomModeOn?"":t("div",null,t("canvas",{id:"canvas1",onClick:()=>this.playButtonAction(),class:"video-canvas"}),t("div",{id:"dom_overlay_container"})),this.dataLoaded?"":t("img",{class:"frame-img",src:this.firstFramePath}),this.isClassroomModeOn?t("img",{class:"overlay-img",src:"/assets/img/play-button-disabled-overlay.png"}):"",!this.isClassroomModeOn&&this.paused?t("img",{class:"overlay-img",onClick:()=>this.playButtonAction(),src:"/assets/img/play-button-overlay.png"}):"",this.isBusy?t("div",null,t("div",{class:"uil-ring-css"},t("div",null),t("a",null,this.formattedProgress))):""),this.dataLoaded?t("div",{class:"navControls"},t("div",{class:"progressBar",onClick:()=>this.rewindAnimation.bind(this)},t("div",{class:"currentProgress",style:{width:this.currentProgressWidth+"px"}})),t("div",{class:"button-panel"},t("ion-button",{color:"primary",onClick:()=>this.rewind5Sec()}," ",t("ion-icon",{name:"rewind"})," "),t("ion-button",{color:"primary",onClick:()=>this.playButtonAction()}," ",this.paused?t("ion-icon",{name:"play"}):t("ion-icon",{name:"pause"})),t("ion-button",{color:"primary",onClick:()=>this.fastForward5Sec()}," ",t("ion-icon",{name:"fastforward"})," "))):"")}static get is(){return"app-animation"}static get properties(){return{animation:{type:String,attr:"animation"},canvasPauseAnimation:{method:!0},canvasPlayAnimation:{method:!0},chapter:{type:String,attr:"chapter"},currentProgressWidth:{state:!0},dataLoaded:{state:!0},imgext:{type:String,attr:"imgext"},isClassroomModeOn:{type:Boolean,attr:"is-classroom-mode-on"},paused:{state:!0},project:{type:String,attr:"project"},session:{type:String,attr:"session"},sizeOfCanvas:{state:!0}}}static get style(){return".video-canvas{position:absolute;display:block;background-color:#fff;width:auto;height:500px}.canvas-container{position:relative;background-color:#fff;width:auto;height:500px}.frame-img{position:absolute;display:block;max-width:100%;width:auto;height:auto}.overlay-img{position:absolute;z-index:9999;top:0;display:block;max-width:100%;width:auto;height:auto}.button-panel{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.navControls{position:relative}.navControls .progressBar{position:relative;left:0;right:0;height:20px;background-color:#8aadea}.navControls .progressBar .currentProgress{position:relative;height:20px;background-color:#488aff;-webkit-transition:width .5s;transition:width .5s}#dom_overlay_container{pointer-events:none;overflow:hidden;width:800px;height:800px;position:absolute;left:0;top:0;display:block}"}}class s{render(){return t("ion-page",{class:"show-page"},t("ion-header",{"md-height":"56px"},t("ion-toolbar",{color:"primary"},t("ion-title",null,"G3DA PWA"))),t("ion-content",null,t("app-animation",{project:"1",session:"1",chapter:"introduction",animation:"p1s1",imgext:"jpg"})))}static get is(){return"app-home"}static get style(){return""}}export{e as AppAnimation,s as AppHome};