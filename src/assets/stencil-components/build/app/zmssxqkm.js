/*! Built with http://stenciljs.com */
const{h:e}=window.App;class t{constructor(){this.isClassroomModeOn=!1,this.paused=!0,this.dataLoaded=!1,this.firstFramePath="",this.basePath="../../assets/project",this.isBusy=!1,this.formattedProgress="0"}componentWillLoad(){const e=document.createElement("script");this.firstFramePath=this.basePath+this.project+"/session"+this.session+"/"+this.chapter+"/"+this.animation+".jpg",e.src=this.basePath+this.project+"/session"+this.session+"/"+this.chapter+"/"+this.animation+".js",document.body.appendChild(e);let t=this;window.playSound=function(e,s){return t.sound&&t.sound.stop(),t.sound=createjs.Sound.play(e,createjs.Sound.INTERRUPT_EARLY,0,0,s),t.sound}}loadAnimation(){if(createjs.Sound.initializeDefaultPlugins()){this.canvas=document.getElementById("canvas1");var e=new createjs.LoadQueue(!1);e.installPlugin(createjs.Sound),e.addEventListener("complete",this.handleComplete(this)),e.addEventListener("fileload",this.handleFileLoad),e.addEventListener("progress",this.handleQueueProgress(this)),e.loadManifest(lib.properties.manifest,!0,this.basePath+this.project+"/session"+this.session+"/"+this.chapter+"/")}}doneLoading(){this.isBusy=!1,this.dataLoaded=!0}handleFileLoad(e){"image"==e.item.type&&(window.createJSImages||(window.createJSImages={}),window.images||(window.images={}),window.createJSImages[e.item.id]=e.result,window.images[e.item.id]=e.result)}handleQueueProgress(e){return function(t){e.formattedProgress=t.loaded?(100*t.loaded).toFixed(0):"0",1==t.loaded&&(console.log("Done loading",e.isBusy),e.doneLoading())}}handleComplete(e){return this.paused=!1,function(){e.stage=new createjs.Stage("canvas1"),e.stage.addChild(new lib[e.animation]),createjs.Ticker.timingMode=createjs.Ticker.RAF_SYNCHED,createjs.Ticker.setFPS(lib.properties.fps),createjs.Ticker.addEventListener("tick",e.tickHandler(e)),createjs.Ticker.setPaused(!1),e.resizeAnimation(e);let t=null;e.stage.getChildAt(0)&&e.stage.getChildAt(0).soundTrack?t=e.stage.getChildAt(0).soundTrack:e.stage.getChildAt(0)&&e.stage.getChildAt(0).children[0]&&e.stage.getChildAt(0).children[0].soundTrack&&(t=e.stage.getChildAt(0).children[0].soundTrack),t||(t=createjs.Sound._instances[0])}}resizeAnimation(e){if(this.dataLoaded){var t=document.getElementById("canvas1").offsetWidth;document.getElementById("canvas1").style.height=t+"px",document.getElementById("canvas1").style.width=t+"px",e.sizeOfCanvas=t,e.stage&&(e.stage.width=t,e.stage.height=t)}}tickHandler(e){var t=!1;return function(s){e.paused||s.paused||e.stage.update();let i=e.stage.children[0];if(e.timeline=i.timeline,e.timeline.position%10==0&&(e.currentProgressWidth=parseFloat((e.timeline.position/e.timeline.duration*e.sizeOfCanvas).toFixed(0))),0==e.timeline.position&&(t=!1),e.timeline.duration-e.timeline.position==1&&!t){t=!0,createjs.Ticker.setPaused(!0);let s=e.sound;s&&s.setPaused(!0)}}}playPauseAnimation(){if(createjs&&createjs.Ticker){let e=!createjs.Ticker.getPaused(),t=this.sound;t&&t.setPaused(e),createjs.Ticker.setPaused(e),this.paused=e}}rewindAnimationTo(e){let t=this.stage.children[0],s=t.timeline;e<0&&(e=0),e>s.duration&&(e=s.duration-10);let i=this.sound;i&&i.setPaused(!0),this.paused?(t.gotoAndStop(e),this.stage.update(),i&&!i.getPaused()&&i.setPaused(!0)):t.gotoAndPlay(e)}rewindAnimation(e){e.stopPropagation();let t=this.stage.children[0].timeline,s=Math.round(e.offsetX/this.sizeOfCanvas*t.duration);this.rewindAnimationTo(s)}rewind5Sec(){let e=lib.properties.fps,t=this.stage.children[0].timeline.position-5*e;this.rewindAnimationTo(t)}fastForward5Sec(){let e=lib.properties.fps,t=this.stage.children[0].timeline.position+5*e;this.rewindAnimationTo(t)}playButtonAction(){this.dataLoaded?this.playPauseAnimation():this.loadAnimation()}muteVolume(){let e=this.sound;e&&(e.volume=0)}downVolume(){let e=this.sound;e&&e._getVolume()>.9&&(e.volume=e._getVolume()-.1)}upVolume(){let e=this.sound;e&&e._getVolume()<1&&(e.volume=e._getVolume()+.1)}render(){return e("div",{class:"canvas-container"},!this.isClassroomModeOn&&this.dataLoaded?e("canvas",{width:"500",height:"500",id:"canvas1",onClick:()=>this.playButtonAction(),class:"video-canvas"}):"",this.dataLoaded?"":e("img",{class:"frame-img",src:this.firstFramePath}),this.isClassroomModeOn?e("img",{class:"overlay-img",src:"/assets/img/play-button-disabled-overlay.png"}):"",this.isClassroomModeOn||this.isBusy||!this.paused?"":e("img",{class:"overlay-img",onClick:()=>this.playButtonAction(),src:"/assets/img/play-button-overlay.png"}),this.dataLoaded?e("div",{class:"navControls"},e("div",{class:"progressBar",onClick:()=>this.rewindAnimation.bind(this)},e("div",{class:"currentProgress",style:{width:this.currentProgressWidth+"px"}})),e("div",{class:"button-panel"},e("ion-button",{color:"primary",onClick:()=>this.rewind5Sec()}," ",e("ion-icon",{name:"rewind"})," "),e("ion-button",{color:"primary",onClick:()=>this.playButtonAction()}," ",this.paused?e("ion-icon",{name:"play"}):e("ion-icon",{name:"pause"})),e("ion-button",{color:"primary",onClick:()=>this.fastForward5Sec()}," ",e("ion-icon",{name:"fastforward"})," "))):"",this.isBusy?e("div",null,e("div",{class:"uil-ring-css"},e("div",null),e("a",null,this.formattedProgress))):"")}static get is(){return"app-animation"}static get properties(){return{animation:{type:String,attr:"animation"},chapter:{type:String,attr:"chapter"},currentProgressWidth:{state:!0},dataLoaded:{state:!0},isClassroomModeOn:{type:Boolean,attr:"is-classroom-mode-on"},paused:{state:!0},project:{type:String,attr:"project"},session:{type:String,attr:"session"},sizeOfCanvas:{state:!0}}}static get style(){return".video-canvas{background-color:#fff;position:relative;display:block;max-width:100%;height:auto}.canvas-container{position:relative}.frame-img{position:absolute;width:100%}.overlay-img{position:absolute;z-index:9999;width:100%;top:0}.button-panel{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.navControls{position:relative}.navControls .progressBar{position:relative;left:0;right:0;height:20px;background-color:#8aadea}.navControls .progressBar .currentProgress{position:relative;height:20px;background-color:#488aff;-webkit-transition:width .5s;transition:width .5s}"}}class s{render(){return e("ion-page",{class:"show-page"},e("ion-header",{"md-height":"56px"},e("ion-toolbar",{color:"primary"},e("ion-title",null,"G3DA PWA"))),e("ion-content",null,e("app-animation",{project:"1",session:"1",chapter:"intro",animation:"p1s1"})))}static get is(){return"app-home"}static get style(){return""}}export{t as AppAnimation,s as AppHome};